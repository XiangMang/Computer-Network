### 分层的体系结构

每层通过以下方式提供服务:
1. 在这层中执行了某些操作
2. 使用直接下层的服务

利用分层的体系结构, 使得某层所提供的服务实现易于改变. 只要该层对其上面的层提供相同的服务, 并且使用来自下面的层的相同服务, 当某层的实现变化时, 该系统的其余部分就可以保持不变. 改变后, 它仅是以不同的方式实现了该功能.
对于大而复杂且需要不断更新的系统, 改变服务的实现而不影响该系统的其他组件时分层的另一个重要优点. 

#### 1.5.1 协议分层

1. 为了给网络协议的设计提供一个结构, 网络设计者以 **分层(layer)** 的方式组织协议并实现这些协议的网络硬件和软件, 每个协议属于这些层次之一. 
2. 一个协议层能够用软件, 硬件或两者结合的方式来实现. 应用层和运输层协议几乎总是在端系统中用软件实现, 物理层和数据链路层通常在与给定链路相关联的网络接口卡中实现, 网络层通常是硬件和软件实现的混合体.
3. 协议分层具有概念化和结构化的优点, 也有着冗余较低层功能和某层的功能可能需要仅在其他某层才出现的信息(如时间戳值)的缺点. 
4. 各层的所有协议被称为 **协议栈(protocol stack)**, 因特网的协议栈由五个层次组成: 物理层, 链路层, 网络层, 运输层和应用层.
	1. 应用层是网络应用程序以及它们的应用层协议存留的地方. 应用层协议分布在多个端系统上, 而一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息分组, 我们将这种位于应用层的信息分组称为 **报文(message)**.
	2. 因特网的运输层在应用程序端点之间传送应用层报文. 因特网中有TCP和UDP两种运输协议, 利用任何一个都能运输应用层报文. TCP向它的应用程序提供面向连接的服务, 包括确保应用层报文向目的地的传递和流量控制. TCP也将长报文划分为短报文, 并提供拥塞控制机制. UDP协议向它的应用程序提供无连接服务, 这是一种不提供不必要服务的服务, 没有可靠性, 没有流量控制, 没有拥塞机制. 我们将运输层的分组称为 **报文段(segment)**.
	3. 因特网的网络层负责将称为 **数据报(datagram)** 的网络层分组从一台主机移动到另一台主机. 在一台源主机中的因特网运输层协议向网络层递交运输层报文段和目的地址.因特网的网络层包括网络协议(IP), 该协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段. IP仅有一个, 所有具有网络层的因特网组件必须运行IP. 因特网的网络层也包括决定路由的路由选择协议, 它根据该路由将数据报从源传输到目的地.
	4. 链路层可以将分组从一个节点移动到路径上的另一个节点. 网络层将数据报下传给链路层, 链路层沿着路径将数据报传递给下一个节点, 在下一个节点, 链路层将数据报上传给网络层. 由链路层提供的服务取决于应用于该链路的特定链路层协议, 因此网络层将受到来自每个不同的链路层协议的不同服务. 我们将链路层分组称为 **帧(frame)**.
	5. 物理层将该节点中的一个个比特从一个节点移动到下一个节点. 在不同场合中, 跨越这些链路移动一个比特是以不同的方式进行的.

#### 1.5.2 封装

>![[封装配图_1.png]]
>主机, 路由器和链路层交换机, 每个都包换不同的层,  反映了它们功能的差异.

上图说明了 **封装(encapsulation)** 这一概念. 在发送主机端, 一个 **应用层报文(application-layer message)** (图中的 $M$)被传输给运输层. 运输层收取报文并附上运输层首部信息(图中的 $H_t$). 运输层因此封装了应用层报文. 运输层则向网络层传递该报文段, 网络层增加了如源和目的端系统地址等网络层首部信息(图中的$H_n$), 生成 **网络层数据报(network-layer datagram)**. 该数据报接下来被传递给链路层, 链路层增加了自己的首部信息并生成 **链路层帧(link-layer frame)**. 

综上, 在每一层, 一个分组具有两种类型的字段: 首部字段和 **有效载荷字段(payload field)**.    有效载荷通常是来自上一层的分组.

以上只是一个简化的过程. 例如, 一个大报文可能被划分为多个运输层报文段(报文段可能被划分为多个网络层数据报). 在接收端需要在连续的数据报中重构这样